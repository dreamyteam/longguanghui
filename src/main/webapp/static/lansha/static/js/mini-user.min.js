/** lansha PopUser */
LSUserMini=function(){this.MAX_UPLOAD="2mb";this.OUT_TIME=5};LSUserMini.prototype={isMPhone:function(phoneNumber){var reg_MPnum=/^0{0,1}(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])[0-9]{8}$/;var isMPhone=true;if(phoneNumber==""||!reg_MPnum.test(phoneNumber)){isMPhone=false}return isMPhone},isNickname:function(nickname){var regNickName=/^[\u4E00-\u9FA5]{1,5}$/;var isNickname=true;if(!regNickName.test(nickname)){console.log("验证不通过");alert(nickname);isNickname=false}return isNickname},inputTips:function(){$(".login-one input").focus(function(){var tips=$(this).data("tips");$(this).addClass("on");$(this).parent().find("p .infoArea").removeClass("error");$(this).parent().find("p .infoArea").html(tips);$(this).parent().find("p .infoArea").show()}).blur(function(){$(this).removeClass("on");$(this).parent().find("p .infoArea").removeClass("error");$(this).parent().find("p .infoArea").html("")})},LoginEnd:function(nickname,isboke){if(isboke==1){window.location.href=location.href;return false}isLogin=1;settime();$("#nickname").text(nickname);$("#nologin").addClass("hide");$("#logined").removeClass("hide");$("#userArea_nologin").addClass("hide");$("#userArea").removeClass("hide");$("#talk_input").removeClass("disabled");$("#talk_input").text("");$("#btn_talk_send").removeClass("nosend");closeLoginRegBox()}};LSUserMini.register=function(){_this=this;_this.sendTime=60;_this.OUT_TIME=1};LSUserMini.register.prototype={init:function(){var lsuser=new LSUserMini;this.op()},op:function(){var _this=this;var lsuser=new LSUserMini;lsuser.inputTips();$("#gendercol .checkbox").on("click",function(){$("#gendercol .checkbox").removeClass("checked");$(this).addClass("checked");$("#gender").val($(this).data("value"))});$("#SendCode").on("click",function(){var telphone=$("#miniTel").val();var API_URL=$.trim($(this).data("apiurl"));if(API_URL==""||API_URL==undefined){$.xbox.tips("验证码接口配置错误！");return false}if($(this).hasClass("disabled")){return false}var t_dt="";if(lsuser.isMPhone(telphone)){var wait=_this.sendTime;function dtime(){if(wait==0){$("#miniTel").attr("disabled",false);$("#SendCode").attr("disabled",false).removeClass("disabled").text("发送验证码");wait=60}else{$("#miniTel").attr("disabled",true);$("#SendCode").attr("disabled",true).addClass("disabled").text("重新发送("+wait+")");wait--;t_dt=setTimeout(function(){dtime()},1000)}}dtime();$.ajax({type:"POST",url:API_URL,data:{telphone:telphone},dataType:"json",success:function(data){if(data.status=="1"){$(".miniiMPTEL").text("短信发送成功，请注意查收！").show()}else{$(".miniiMPTEL").text(data.failed).addClass("error").show();clearTimeout(t_dt);$("#miniTel").attr("disabled",false);$("#SendCode").attr("disabled",false).removeClass("disabled").text("发送验证码");return false}}})}else{$(".miniiMPTEL").addClass("error").text("请输入正确的手机号").show();return false}});$(".login-one .checkbox").on("click",function(){$(".login-one .checkbox").removeClass("checked");$(this).addClass("checked");$("#genderMini").val($(this).data("value"))});$("#regsubmitMini").on("click",function(){var API_URL=$("#frmUserRegMini").attr("action");var theBtn=$(this);if(API_URL==""||API_URL==undefined){$.xbox.tips("API_URL配置错误！");return false}if(theBtn.hasClass("disabled")){return false}$("#miniTel1").val($.trim($("#miniTel").val()));if(_this.check()){theBtn.addClass("disabled");$("#pwdrehide").val($.md5($.trim($("#miniRePassword").val())));$.ajax({type:"POST",url:API_URL,data:$("#frmUserRegMini").serialize(),dataType:"json",success:function(data){if(data.status=="1"){$.xbox.tips("恭喜你，注册成功！");lsuser.LoginEnd(data.nickname,data.isboke)}else{$.xbox.tips(data.failed);theBtn.removeClass("disabled");return false}}})}else{theBtn.removeClass("disabled");return false}})},check:function(){var _this=this;var isPass=true;var lsusermini=new LSUserMini;var telphone=$.trim($("#miniTel").val());var nickname=$.trim($("#regNickname").val());var checkTel=lsusermini.isMPhone(telphone);var password=$.trim($("#miniPassword").val());var password2=$.trim($("#miniRePassword").val());if($.trim($("#rcode").val())==""){$(".iRcodeMini").addClass("error").text("请输入手机验证码").show();isPass=false}else{$(".iRcodeMini").text("").hide()}if(!lsusermini.isNickname(nickname)){$(".iNickname").addClass("error").text("请输入您的昵称（5位以内汉字）").show();isPass=false}else{$(".iNickname").removeClass("error").text("").hide()}if(telphone==""){$(".miniiMPTEL").addClass("error").text("请输入您的手机号").show();isPass=false}else{if(!checkTel){$(".miniiMPTEL").addClass("error").text("请输入正确的手机号").show();isPass=false}else{$(".miniiMPTEL").removeClass("error").text("").hide()}}if(password.length<6||password.length>16){$(".iPasswordM").addClass("error").text("输入密码有误，请输入6～16位的密码").show();isPass=false}else{$(".iPasswordM").text("").hide()}if(password2!=password){$(".iPasswordM2").addClass("error").text("输入密码不一致").show();isPass=false}else{$(".iPasswordM2").text("").hide()}return isPass}};LSUserMini.login=function(){this.OUT_TIME=1};LSUserMini.login.prototype={init:function(){this.op()},op:function(){var _this=this;var lsuser=new LSUserMini;
$(".login-list input").focus(function(){var tips=$(this).data("tips");$(this).addClass("on");$(this).parent().find("p .infoArea").removeClass("error");$(this).parent().find("p .infoArea").html(tips);$(this).parent().find("p .infoArea").show()}).blur(function(){$(this).removeClass("on");$(this).parent().find("p .infoArea").removeClass("error");$(this).parent().find("p .infoArea").html("")});$("#frmSubmitMini").on("click",function(){var API_URL=$.trim($("#frmUserLoginMini").attr("action"));var theBtn=$(this);if(API_URL==""||API_URL==undefined){$.xbox.tips("API_URL配置错误！");return false}if(theBtn.hasClass("disabled")){return false}if(_this.check()){theBtn.addClass("disabled");$("#pwdhidelogin").val($.md5($.trim($("#loginMinpassword").val())));$.ajax({type:"POST",url:API_URL,data:$("#frmUserLoginMini").serialize(),dataType:"json",success:function(data){if(data.status=="1"){$.xbox.tips("恭喜您，登录成功！");lsuser.LoginEnd(data.nickname,data.isboke)}else{$.xbox.tips(data.failed);theBtn.removeClass("disabled");return false}}})}else{theBtn.removeClass("disabled");return false}})},check:function(){var _this=this;var isPass=true;var lsuser=new LSUserMini;var telphone=$.trim($("#loginMinTel").val());var password=$.trim($("#loginMinpassword").val());var checkTel=lsuser.isMPhone(telphone);if(telphone==""){$(".loginiMPTEL").addClass("error").text("请输入您的手机号").show();isPass=false}else{if(!checkTel){$(".loginiMPTEL").addClass("error").text("请输入正确的手机号").show();isPass=false}else{$(".loginiMPTEL").removeClass("error").text("").hide()}}if(password==""){$(".loginiPassword").addClass("error").text("请输入您的密码").show();isPass=false}else{if(password.length<6||password.length>16){$(".loginiPassword").addClass("error").text("请输入正确密码（6-16位）").show();isPass=false}else{$(".loginiPassword").removeClass("error").text("").hide()}}return isPass}};function loginShow(){$(".popup-slide span:first-child").addClass("cur").siblings().removeClass("cur");$(".popup-box,.popup-bg,.popup-login").show();$(".popup-reg").hide();$(".popup-box").css("marginTop",-($(".popup-box").height()/2))}function regShow(){$(".popup-slide span:last-child").addClass("cur").siblings().removeClass("cur");$(".popup-box,.popup-bg,.popup-reg").show();$(".popup-login").hide();$(".popup-box").css("marginTop",-($(".popup-box").height()/2))}function closeLoginRegBox(){$(".popup-box,.popup-bg").hide()}$(".popup-box").css("marginTop",-($(".popup-box").height()/2));$(".popup-slide span").on("click",function(){var flag=$(this).data("slide");$(".popup-slide ."+flag).removeClass("cur");$(this).addClass("cur").siblings().removeClass("cur");if(flag=="login"){$(".popup-login").show();$(".popup-reg").hide();$(".popup-box").css("marginTop",-($(".popup-box").height()/2))}else{$(".popup-login").hide();$(".popup-reg").show();$(".popup-box").css("marginTop",-($(".popup-box").height()/2))}});$(".popup-close").on("click",function(){closeLoginRegBox()});$(function(){new LSUserMini.login().init();new LSUserMini.register().init();$("#nologin a:first-child").on("click",function(){loginShow()});$("#nologin a:last-child").on("click",function(){regShow()})});